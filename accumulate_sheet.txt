SELECT ad.name as ad_account_name, ad.tz_name as time_zone,
c.name as campaign_name, c.id as campaign_id, c.status, c.start_time, c.created_time as launch_date,
CAST(SUM(fb.total_spent) AS FLOAT) as amount_spent,
CAST(SUM(fb.impressions) AS INTEGER) as impressions,
CAST(ROUND(SUM(fb.link_clicks), 2) AS FLOAT) as link_clicks,
TRUNC((SUM(fb.link_clicks)::numeric / SUM(fb.total_spent)::numeric), 4) as cpc,
TRUNC((SUM(fb.total_spent)::numeric / (SUM(fb.impressions::numeric) / 1000::numeric)), 4) as cpm,
TRUNC((SUM(fb.link_clicks)::numeric / SUM(fb.impressions)::numeric), 5) as ctr
FROM campaigns c
JOIN ad_accounts ad ON ad.id = c.ad_account_id
JOIN facebook fb ON fb.campaign_id = c.id
WHERE c.status = 'ACTIVE'
GROUP BY ad.name, ad.tz_name, c.name, c.id, c.status, c.start_time, c.created_time
LIMIT 20;

